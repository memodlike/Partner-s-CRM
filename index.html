<!DOCTYPE html>
<html lang="ru" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Кабинет партнёра - Портал для туроператоров">
    <title>Кабинет партнёра</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="app">
        <!-- Navigation -->
        <nav class="nav" id="navbar" role="navigation" aria-label="Главная навигация">
            <div class="nav-brand">
                <div class="nav-brand-icon" aria-hidden="true">КП</div>
                <span>Кабинет партнёра</span>
            </div>

            <div class="nav-menu" id="navMenu">
                <span class="nav-brand-text"
                    style="font-weight: 600; font-size: 1rem; color: var(--color-text-secondary);">SABR Insurance</span>
            </div>

            <div class="nav-actions">
                <!-- Currency Ticker -->
                <div class="currency-ticker" id="currencyTicker">
                    <div class="currency-item">
                        <span class="currency-code">USD</span>
                        <span class="currency-rate" id="rateUSD">475.50</span>
                        <span class="currency-change positive" id="changeUSD">+0.8%</span>
                    </div>
                    <div class="currency-item">
                        <span class="currency-code">EUR</span>
                        <span class="currency-rate" id="rateEUR">515.20</span>
                        <span class="currency-change negative" id="changeEUR">-0.3%</span>
                    </div>
                    <div class="currency-item">
                        <span class="currency-code">RUB</span>
                        <span class="currency-rate" id="rateRUB">5.12</span>
                        <span class="currency-change positive" id="changeRUB">+1.2%</span>
                    </div>
                </div>

                <!-- Role Simulator -->
                <div class="role-simulator" id="roleSimulator">
                    <button class="role-trigger" id="roleTrigger" aria-haspopup="true" aria-expanded="false">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" aria-hidden="true">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                            <circle cx="12" cy="7" r="4" />
                        </svg>
                        <span id="currentRoleName">Оператор</span>
                        <svg class="role-chevron" width="12" height="12" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" aria-hidden="true">
                            <polyline points="6 9 12 15 18 9" />
                        </svg>
                    </button>
                    <div class="role-dropdown" id="roleDropdown" role="menu">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Theme Toggle -->
                <button class="theme-toggle" id="themeToggle" aria-label="Переключить тему">
                    <svg class="sun-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <circle cx="12" cy="12" r="5" />
                        <line x1="12" y1="1" x2="12" y2="3" />
                        <line x1="12" y1="21" x2="12" y2="23" />
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
                        <line x1="1" y1="12" x2="3" y2="12" />
                        <line x1="21" y1="12" x2="23" y2="12" />
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
                    </svg>
                    <svg class="moon-icon hidden" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
                    </svg>
                </button>

                <!-- Audit Log Toggle -->
                <button class="btn btn-ghost btn-icon" id="auditLogToggle" aria-label="Журнал аудита">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <polyline points="14 2 14 8 20 8" />
                        <line x1="16" y1="13" x2="8" y2="13" />
                        <line x1="16" y1="17" x2="8" y2="17" />
                        <polyline points="10 9 9 9 8 9" />
                    </svg>
                </button>

                <!-- User Menu -->
                <button class="btn btn-ghost btn-icon" id="logoutBtn" aria-label="Выйти">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                        <polyline points="16 17 21 12 16 7" />
                        <line x1="21" y1="12" x2="9" y2="12" />
                    </svg>
                </button>
            </div>
        </nav>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar" role="complementary" aria-label="Боковая панель">
            <div class="sidebar-section">
                <div class="sidebar-section-header">
                    <div class="sidebar-section-title" id="sidebarMenuTitle">Меню</div>
                    <button class="sidebar-toggle" id="sidebarToggle" title="Свернуть меню" aria-label="Свернуть меню" aria-expanded="true">
                        <svg class="sidebar-toggle-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15 18 9 12 15 6" />
                        </svg>
                    </button>
                </div>
                <nav class="sidebar-menu" aria-label="Боковое меню">
                    <a href="#/dashboard" class="sidebar-link" data-nav="dashboard">
                        <svg class="sidebar-link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="3" y="3" width="7" height="7" />
                            <rect x="14" y="3" width="7" height="7" />
                            <rect x="14" y="14" width="7" height="7" />
                            <rect x="3" y="14" width="7" height="7" />
                        </svg>
                        <span class="sidebar-link-text">Сводка</span>
                    </a>
                    <a href="#/new-contract" class="sidebar-link" data-nav="new-contract">
                        <svg class="sidebar-link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                            <polyline points="14 2 14 8 20 8" />
                            <line x1="12" y1="18" x2="12" y2="12" />
                            <line x1="9" y1="15" x2="15" y2="15" />
                        </svg>
                        <span class="sidebar-link-text">Оформление</span>
                    </a>
                    <a href="#/contracts" class="sidebar-link" data-nav="contracts">
                        <svg class="sidebar-link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                            <polyline points="14 2 14 8 20 8" />
                            <line x1="16" y1="13" x2="8" y2="13" />
                            <line x1="16" y1="17" x2="8" y2="17" />
                        </svg>
                        <span class="sidebar-link-text">Договоры</span>
                    </a>
                    <a href="#/reports" class="sidebar-link" data-nav="reports">
                        <svg class="sidebar-link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10" />
                            <line x1="12" y1="20" x2="12" y2="4" />
                            <line x1="6" y1="20" x2="6" y2="14" />
                        </svg>
                        <span class="sidebar-link-text">Отчёты</span>
                    </a>
                    <a href="#/admin" class="sidebar-link" data-nav="admin" id="sidebarAdmin">
                        <svg class="sidebar-link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="12" cy="12" r="3" />
                            <path
                                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                        </svg>
                        <span class="sidebar-link-text">Админ</span>
                    </a>
                    <a href="#/test-lab" class="sidebar-link" data-nav="test-lab">
                        <svg class="sidebar-link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path
                                d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z" />
                        </svg>
                        <span class="sidebar-link-text">Test Lab</span>
                    </a>
                </nav>
            </div>

            <!-- Current Role Info -->
            <div class="sidebar-section" id="roleInfoSection">
                <div class="sidebar-section-title">Текущая роль</div>
                <div class="card" style="padding: var(--space-4);">
                    <div class="font-semibold text-sm" id="roleInfoName">Оператор</div>
                    <div class="text-xs text-secondary mt-2" id="roleInfoDesc">Описание роли</div>
                    <div class="badge badge-primary mt-4" id="roleInfoScope">Scope: company</div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content" id="mainContent">
            <!-- Pages will be rendered here -->
        </main>

        <!-- Audit Log Drawer -->
        <div class="drawer-backdrop" id="auditDrawerBackdrop"></div>
        <div class="drawer" id="auditDrawer" role="dialog" aria-label="Журнал аудита">
            <div class="drawer-header">
                <h2 class="modal-title">Журнал аудита</h2>
                <button class="modal-close" id="auditDrawerClose" aria-label="Закрыть">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="drawer-body" id="auditLogContent">
                <!-- Audit events will be rendered here -->
            </div>
        </div>

        <!-- Toast Container -->
        <div class="toast-container" id="toastContainer" role="alert" aria-live="polite"></div>

        <!-- Modal Backdrop -->
        <div class="modal-backdrop" id="modalBackdrop"></div>

        <!-- Confirm Modal -->
        <div class="modal" id="confirmModal" role="dialog" aria-labelledby="confirmModalTitle">
            <div class="modal-header">
                <h3 class="modal-title" id="confirmModalTitle">Подтверждение</h3>
                <button class="modal-close" data-modal-close aria-label="Закрыть">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="confirmModalBody">
                <!-- Content set by JS -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal-close>Отмена</button>
                <button class="btn btn-primary" id="confirmModalOk">Подтвердить</button>
            </div>
        </div>
    </div>

    <!-- Page Templates (Hidden, cloned by router) -->
    <template id="loginPageTemplate">
        <div class="login-page">
            <div class="login-card animate-slide-up">
                <div class="login-logo">
                    <div class="login-logo-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                        </svg>
                    </div>
                    <h1 class="login-title">Кабинет партнёра</h1>
                    <p class="login-subtitle">Вход для туроператоров</p>
                </div>

                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label" for="loginEmail">Email</label>
                        <input type="email" class="form-input" id="loginEmail" placeholder="operator@company.kz">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="loginPassword">Пароль</label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="••••••••">
                    </div>
                    <button type="submit" class="btn btn-primary btn-lg w-full mt-5">
                        Войти
                    </button>
                </form>

                <p class="text-center text-sm text-secondary mt-5">
                    Для демо используйте любой email из списка пользователей
                </p>
            </div>
        </div>
    </template>

    <template id="dashboardPageTemplate">
        <div class="page animate-fade-in">
            <div class="page-header">
                <h1 class="page-title">Сводка</h1>
                <p class="page-subtitle">Обзор деятельности и ключевые показатели</p>
            </div>

            <!-- Stats Cards -->
            <div class="card-grid mb-5">
                <div class="card stat-card">
                    <div class="stat-value" id="statActiveContracts">0</div>
                    <div class="stat-label">Активных договоров</div>
                    <div class="stat-change positive">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" />
                        </svg>
                        +12% за месяц
                    </div>
                </div>
                <div class="card stat-card">
                    <div class="stat-value" id="statPendingContracts">0</div>
                    <div class="stat-label">Выписаны</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-value" id="statDraftContracts">0</div>
                    <div class="stat-label">Созданы</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-value" id="statTotalPremium">0 ₸</div>
                    <div class="stat-label">Премия за месяц</div>
                    <div class="stat-change positive">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" />
                        </svg>
                        +8% за месяц
                    </div>
                </div>
            </div>

            <!-- Recent Contracts -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Последние договоры</h2>
                    <a href="#/contracts" class="btn btn-secondary btn-sm">Все договоры</a>
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Номер</th>
                                <th>Тип</th>
                                <th>Страхователь</th>
                                <th>Период</th>
                                <th>Статус</th>
                                <th>Премия</th>
                            </tr>
                        </thead>
                        <tbody id="recentContractsTable">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </template>

    <template id="newContractPageTemplate">
        <div class="page animate-fade-in">
            <div class="page-header">
                <h1 class="page-title">Оформление</h1>
                <p class="page-subtitle">Выберите продукт одним кликом и заполните только нужные поля</p>
            </div>

            <!-- Contract Form + Review Panel Layout -->
            <div class="contract-layout">
                <!-- Main Form -->
                <div class="contract-form-stack">
                    <div class="card contract-block contract-block-product">
                        <div class="form-section" id="stepProduct">
                            <h3 class="card-title mb-5">Выбор продукта</h3>
                            <div class="form-group">
                                <label class="form-label required">Продукт</label>
                                <div class="product-picker" id="productPicker" role="listbox" aria-label="Выбор продукта">
                                    <!-- Product cards are rendered by JS -->
                                </div>
                                <div class="form-helper" id="productPickerHint">Выбран продукт: ВЗР</div>
                            </div>
                        </div>
                    </div>

                    <div class="card contract-block contract-block-details">
                        <div class="form-section" id="stepDetails">
                            <h3 class="card-title mb-5">Данные оформления</h3>

                            <div class="form-group" id="generalContractGroup">
                                <label class="form-label required">Генеральный договор</label>
                                <select class="form-select" id="generalContractSelect">
                                    <!-- Populated by JS -->
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label required">Тип бланка</label>
                                <select class="form-select" id="blankTypeSelect">
                                    <option value="electronic">Электронный полис</option>
                                    <option value="paper">Бумажный бланк</option>
                                </select>
                            </div>

                            <div class="form-group hidden" id="paperBlankGroup">
                                <label class="form-label required">Бумажный бланк</label>
                                <select class="form-select" id="paperBlankSelect">
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                        </div>

                        <div class="contract-divider"></div>

                        <!-- Step 2: Coverage Details -->
                        <div class="form-section" id="stepCoverage">
                        <h3 class="card-title mb-5">Параметры страхования</h3>

                        <!-- Territories -->
                        <div class="form-group">
                            <label class="form-label required">Территория покрытия (максимум 3 страны)</label>
                            <div id="territoriesContainer" class="flex gap-2 flex-wrap mb-2">
                                <!-- Tags added here -->
                            </div>
                            <select class="form-select" id="territorySelect">
                                <option value="">Выберите страну/территорию...</option>
                                <!-- Populated by JS -->
                            </select>
                            <div class="form-helper" id="territoryHint"></div>
                        </div>

                        <!-- VZR-specific fields -->
                        <div id="vzrFields" class="product-specific-fields">
                            <div class="form-group">
                                <label class="form-label required">Программа</label>
                                <select class="form-select" id="programSelect">
                                    <!-- Populated by JS -->
                                </select>
                            </div>

                            <div class="form-group hidden" id="multiTripHint">
                                <div class="badge badge-info">
                                    Multi Trip: покрытие нескольких поездок в течение года, каждая до 90 дней
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label required">Вариант программы</label>
                                <select class="form-select" id="variantSelect">
                                    <!-- Populated by JS -->
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label required">Цель поездки</label>
                                <select class="form-select" id="purposeSelect">
                                    <!-- Populated by JS -->
                                </select>
                                <div class="form-helper">
                                    Дополнительно покрываются: самодеятельный туризм, любительский спорт, серфинг, спортивные игры, аквапарки,
                                    водные активности, вело- и пешие маршруты, пещеры, джип-сафари, поездки на животных, пляжные виды спорта,
                                    кемпинг и другие аналогичные активности (до 3 страховых случаев).
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label required">Страховая сумма</label>
                                <select class="form-select" id="amountSelect">
                                    <!-- Populated by JS -->
                                </select>
                                <div class="form-helper" id="amountHint"></div>
                            </div>
                        </div>

                        <!-- Dates -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--space-4);">
                            <div class="form-group">
                                <label class="form-label required">Дата начала</label>
                                <input type="date" class="form-input" id="startDate">
                                <div class="form-helper">Дата начала должна быть не ранее следующего дня после даты выписки.</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label required">Дата окончания</label>
                                <input type="date" class="form-input" id="endDate">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Количество дней</label>
                                <input type="number" class="form-input" id="daysCount" min="1" placeholder="Напр. 7">
                            </div>
                        </div>
                        </div>

                        <div class="contract-divider"></div>

                        <!-- Step 3: Insured Persons -->
                        <div class="form-section" id="stepPersons">
                        <h3 class="card-title mb-5">Застрахованные лица <span class="text-secondary font-normal"
                                id="personsCounter">(0 / 5)</span></h3>

                        <div id="personsContainer">
                            <!-- Person cards added here -->
                        </div>

                        <div class="form-group">
                            <label class="form-label">Добавить по ИИН</label>
                            <div class="flex gap-3">
                                <input type="text" class="form-input" id="iinInput" placeholder="Введите ИИН (12 цифр)"
                                    maxlength="12" style="flex: 1;">
                                <button type="button" class="btn btn-secondary" id="requestKdpBtn">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <circle cx="11" cy="11" r="8" />
                                        <line x1="21" y1="21" x2="16.65" y2="16.65" />
                                    </svg>
                                    Запросить КДП
                                </button>
                            </div>
                            <div class="form-helper">Введите ИИН, запросите КДП, после подтверждения согласия данные автоматически подтянутся из госбазы.</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Добавить без ИИН (для возрастов &lt; 1 и &gt; 64)</label>
                            <div class="flex gap-3">
                                <input type="date" class="form-input" id="manualBirthDateInput" style="flex: 1;">
                                <button type="button" class="btn btn-secondary" id="addManualPersonBtn">
                                    Добавить в расчёт
                                </button>
                            </div>
                            <div class="form-helper">Используется для тарификации без ввода ИИН и паспортных данных.</div>
                        </div>
                        </div>

                        <!-- Actions -->
                        <div class="flex justify-between items-center gap-4 mt-8 pt-7"
                            style="border-top: 1px solid var(--color-divider);">
                            <button type="button" class="btn btn-secondary" id="saveDraftBtn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                                    <polyline points="17 21 17 13 7 13 7 21" />
                                    <polyline points="7 3 7 8 15 8" />
                                </svg>
                                Сохранить черновик
                            </button>
                            <button type="button" class="btn btn-primary btn-lg" id="activateBtn" disabled>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <polyline points="20 6 9 17 4 12" />
                                </svg>
                                Активировать
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Review Panel (Sticky) -->
                <div class="review-panel">
                    <div class="review-panel-title">Сводка договора</div>

                    <div class="review-item">
                        <span class="review-item-label">Продукт</span>
                        <span class="review-item-value" id="reviewProduct">-</span>
                    </div>
                    <div class="review-item">
                        <span class="review-item-label">Территория</span>
                        <span class="review-item-value" id="reviewTerritory">-</span>
                    </div>
                    <div class="review-item" id="reviewProgramRow">
                        <span class="review-item-label">Программа</span>
                        <span class="review-item-value" id="reviewProgram">-</span>
                    </div>
                    <div class="review-item">
                        <span class="review-item-label">Период</span>
                        <span class="review-item-value" id="reviewPeriod">-</span>
                    </div>
                    <div class="review-item" id="reviewAmountRow">
                        <span class="review-item-label">Страховая сумма</span>
                        <span class="review-item-value" id="reviewAmount">-</span>
                    </div>
                    <div class="review-item">
                        <span class="review-item-label">Застрахованных</span>
                        <span class="review-item-value" id="reviewPersons">0</span>
                    </div>
                    <div class="review-item">
                        <span class="review-item-label">КДП</span>
                        <span class="review-item-value" id="reviewKdp">
                            <span class="badge badge-error">Не получено</span>
                        </span>
                    </div>

                    <div class="review-total">
                        <span>Премия</span>
                        <span class="review-total-value" id="reviewPremium">0 ₸</span>
                    </div>

                    <!-- Activation Status -->
                    <div class="mt-4 hidden" id="activationStatus">
                        <div class="flex items-center gap-3 p-4"
                            style="background: var(--color-bg-secondary); border-radius: var(--radius-base);">
                            <div class="loading-spinner" id="activationSpinner"></div>
                            <div>
                                <div class="font-semibold" id="activationStatusTitle">Отправка в CRM...</div>
                                <div class="text-sm text-secondary" id="activationStatusDesc">Ожидание ответа</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="contractsPageTemplate">
        <div class="page animate-fade-in">
            <div class="page-header flex justify-between items-center">
                <div>
                    <h1 class="page-title">Договоры</h1>
                    <p class="page-subtitle">Поиск и управление договорами</p>
                </div>
                <a href="#/new-contract" class="btn btn-primary" id="newContractBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19" />
                        <line x1="5" y1="12" x2="19" y2="12" />
                    </svg>
                    Оформление
                </a>
            </div>

            <!-- Filters -->
            <div class="filters-bar">
                <div class="form-group">
                    <label class="form-label">Поиск</label>
                    <input type="text" class="form-input" id="contractSearchInput" placeholder="Номер, ИИН, ФИО...">
                </div>
                <div class="form-group">
                    <label class="form-label">Статус</label>
                    <select class="form-select" id="contractStatusFilter">
                        <option value="">Все</option>
                        <option value="draft">Создан</option>
                        <option value="pending">Выписан</option>
                        <option value="active">Заключен</option>
                        <option value="rejected">Отклонён</option>
                        <option value="cancelled">Расторгнут</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Тип</label>
                    <select class="form-select" id="contractTypeFilter">
                        <option value="">Все</option>
                        <option value="travel">ВЗР</option>
                        <option value="mandatory">ОСТ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Период с</label>
                    <input type="date" class="form-input" id="contractDateFrom">
                </div>
                <div class="form-group">
                    <label class="form-label">Период по</label>
                    <input type="date" class="form-input" id="contractDateTo">
                </div>
                <div class="form-group" style="align-self: flex-end;">
                    <button class="btn btn-secondary" id="contractFilterBtn">Применить</button>
                </div>
            </div>

            <!-- Contracts Table -->
            <div class="card">
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>№ / ID</th>
                                <th>Тип</th>
                                <th>Страхователь</th>
                                <th>Территория</th>
                                <th>Период</th>
                                <th>Статус</th>
                                <th>Премия</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody id="contractsTableBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>

                <!-- Empty State -->
                <div class="empty-state hidden" id="contractsEmptyState">
                    <svg class="empty-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="1.5">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <polyline points="14 2 14 8 20 8" />
                    </svg>
                    <h3 class="empty-state-title">Договоры не найдены</h3>
                    <p class="empty-state-desc">Попробуйте изменить параметры поиска или создайте новый договор</p>
                </div>
            </div>
        </div>
    </template>

    <template id="reportsPageTemplate">
        <div class="page animate-fade-in">
            <div class="page-header">
                <h1 class="page-title">Отчёты</h1>
                <p class="page-subtitle">Аналитика и экспорт данных</p>
            </div>

            <!-- Filters -->
            <div class="filters-bar">
                <div class="form-group">
                    <label class="form-label">Период с</label>
                    <input type="date" class="form-input" id="reportDateFrom">
                </div>
                <div class="form-group">
                    <label class="form-label">Период по</label>
                    <input type="date" class="form-input" id="reportDateTo">
                </div>
                <div class="form-group">
                    <label class="form-label">Продукт</label>
                    <select class="form-select" id="reportProductFilter">
                        <option value="">Все</option>
                        <option value="travel">ВЗР</option>
                        <option value="mandatory">ОСТ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Статус</label>
                    <select class="form-select" id="reportStatusFilter">
                        <option value="">Все</option>
                        <option value="active">Заключен</option>
                        <option value="rejected">Отклонён</option>
                        <option value="cancelled">Расторгнут</option>
                    </select>
                </div>
                <div class="form-group" id="reportCompanyFilterGroup">
                    <label class="form-label">Туркомпания</label>
                    <select class="form-select" id="reportCompanyFilter">
                        <option value="">Все</option>
                    </select>
                </div>
                <div class="form-group" style="align-self: flex-end;">
                    <button class="btn btn-secondary" id="reportApplyBtn">Применить</button>
                </div>
            </div>

            <!-- Stats Summary -->
            <div class="card-grid mb-5">
                <div class="card stat-card">
                    <div class="stat-value" id="reportTotalContracts">0</div>
                    <div class="stat-label">Всего договоров</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-value" id="reportTotalPremium">0 ₸</div>
                    <div class="stat-label">Общая премия</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-value" id="reportAvgPremium">0 ₸</div>
                    <div class="stat-label">Средняя премия</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-value" id="reportRejectionRate">0%</div>
                    <div class="stat-label">Коэффициент отказов</div>
                </div>
            </div>

            <!-- Export Buttons -->
            <div class="card mb-5">
                <div class="card-header">
                    <h2 class="card-title">Экспорт данных</h2>
                </div>
                <div class="flex gap-3">
                    <button class="btn btn-secondary" id="exportCsvBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                            <polyline points="7 10 12 15 17 10" />
                            <line x1="12" y1="15" x2="12" y2="3" />
                        </svg>
                        Export CSV
                    </button>
                    <button class="btn btn-secondary" id="exportJsonBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                            <polyline points="7 10 12 15 17 10" />
                            <line x1="12" y1="15" x2="12" y2="3" />
                        </svg>
                        Export JSON
                    </button>
                </div>
            </div>

            <!-- Report Table -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Детализация</h2>
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Дата</th>
                                <th>Номер</th>
                                <th>Тип</th>
                                <th>Туркомпания</th>
                                <th>Территория</th>
                                <th>Статус</th>
                                <th>Премия</th>
                            </tr>
                        </thead>
                        <tbody id="reportTableBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </template>

    <template id="adminPageTemplate">
        <div class="page animate-fade-in">
            <div class="page-header">
                <h1 class="page-title">Администрирование</h1>
                <p class="page-subtitle">Управление пользователями и настройками</p>
            </div>

            <!-- Tabs -->
            <div class="flex gap-2 mb-5">
                <button class="btn btn-secondary active" data-admin-tab="users">Пользователи</button>
                <button class="btn btn-secondary" data-admin-tab="blanks">Бланки</button>
                <button class="btn btn-secondary" data-admin-tab="settings">Настройки</button>
            </div>

            <!-- Users Tab -->
            <div class="card" id="adminUsersTab">
                <div class="card-header">
                    <h2 class="card-title">Пользователи</h2>
                    <button class="btn btn-primary btn-sm" id="addUserBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                        Добавить
                    </button>
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Имя</th>
                                <th>Email</th>
                                <th>Роль</th>
                                <th>Компания</th>
                                <th>Регион</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody id="adminUsersTable">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Blanks Tab (Hidden by default) -->
            <div class="card hidden" id="adminBlanksTab">
                <div class="card-header">
                    <h2 class="card-title">Бумажные бланки</h2>
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Туркомпания</th>
                                <th>Серия</th>
                                <th>Номер</th>
                                <th>Статус</th>
                                <th>Использован в</th>
                            </tr>
                        </thead>
                        <tbody id="adminBlanksTable">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Settings Tab (Hidden by default) -->
            <div class="card hidden" id="adminSettingsTab">
                <h2 class="card-title mb-5">Настройки системы</h2>
                <div class="form-group">
                    <label class="form-check">
                        <input type="checkbox" class="form-check-input" id="settingEnablePartnerAdmin">
                        <span class="form-check-label">Разрешить админам туркомпаний управлять пользователями</span>
                    </label>
                </div>
                <div class="form-group">
                    <label class="form-label">Максимум застрахованных в одном договоре</label>
                    <input type="number" class="form-input" id="settingMaxPersons" value="5" min="1" max="10"
                        style="max-width: 100px;">
                </div>
                <div class="form-group">
                    <label class="form-label">Максимум территорий</label>
                    <input type="number" class="form-input" id="settingMaxTerritories" value="3" min="1" max="5"
                        style="max-width: 100px;">
                </div>
                <button class="btn btn-primary mt-4" id="saveSettingsBtn">Сохранить настройки</button>
            </div>
        </div>
    </template>

    <template id="testLabPageTemplate">
        <div class="page animate-fade-in">
            <div class="page-header">
                <h1 class="page-title">Test Lab</h1>
                <p class="page-subtitle">Тестирование функциональности и ограничений</p>
            </div>

            <!-- CRM Simulator Panel -->
            <div class="crm-simulator mb-5" id="testLabCrmSimulator">
                <div class="crm-simulator-header">
                    <div class="crm-simulator-title">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2" />
                            <line x1="8" y1="21" x2="16" y2="21" />
                            <line x1="12" y1="17" x2="12" y2="21" />
                        </svg>
                        CRM Simulator для тестов
                    </div>
                </div>
                <div class="crm-simulator-controls">
                    <div class="form-group">
                        <label class="form-label">Режим ответа</label>
                        <select class="form-select" id="testCrmResponseMode">
                            <option value="auto">Auto (случайный)</option>
                            <option value="ok">Force OK</option>
                            <option value="fail">Force FAIL</option>
                        </select>
                    </div>
                    <div class="form-group" id="testCrmFailReasonGroup">
                        <label class="form-label">Причина отказа (если FAIL)</label>
                        <select class="form-select" id="testCrmFailReason">
                            <option value="AML_HIT">AML_HIT - AML проверка</option>
                            <option value="SANCTION_MATCH">SANCTION_MATCH - Санкции</option>
                            <option value="KDP_MISSING">KDP_MISSING - Нет КДП</option>
                            <option value="INVALID_IIN">INVALID_IIN - Некорректный ИИН</option>
                            <option value="DUPLICATE">DUPLICATE - Дубликат</option>
                            <option value="DATE_INVALID">DATE_INVALID - Даты</option>
                            <option value="LIMIT_EXCEEDED">LIMIT_EXCEEDED - Лимит</option>
                            <option value="CRM_VALIDATION_ERROR">CRM_VALIDATION_ERROR</option>
                            <option value="INTEGRATION_TIMEOUT">INTEGRATION_TIMEOUT</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Latency (ms)</label>
                        <input type="number" class="form-input" id="testCrmLatency" value="500" min="0" max="3000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Вероятность таймаута (%)</label>
                        <input type="number" class="form-input" id="testCrmTimeoutChance" value="5" min="0" max="100">
                    </div>
                    <label class="form-check">
                        <input type="checkbox" class="form-check-input" id="testAmlCheckEnabled" checked>
                        <span class="form-check-label">AML Prime Source check</span>
                    </label>
                </div>
            </div>

            <!-- Test Controls -->
            <div class="card mb-5">
                <div class="card-header">
                    <h2 class="card-title">Stress Test Runner</h2>
                </div>
                <p class="text-secondary mb-4">Запуск автоматических тестов для проверки всех сценариев и ограничений.
                </p>
                <div class="flex gap-3">
                    <button class="btn btn-primary btn-lg" id="runStressTestBtn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polygon points="5 3 19 12 5 21 5 3" />
                        </svg>
                        Run Stress Test
                    </button>
                    <button class="btn btn-secondary" id="clearTestResultsBtn">
                        Очистить результаты
                    </button>
                </div>
            </div>

            <!-- Test Results -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Результаты тестов</h2>
                    <div class="flex gap-3">
                        <span class="badge badge-success" id="testPassedCount">Passed: 0</span>
                        <span class="badge badge-error" id="testFailedCount">Failed: 0</span>
                    </div>
                </div>
                <div class="test-results" id="testResultsContainer">
                    <div class="empty-state" style="padding: var(--space-6);">
                        <p class="text-secondary">Нажмите "Run Stress Test" для запуска тестов</p>
                    </div>
                </div>
            </div>

            <!-- Integration Log -->
            <div class="card mt-5">
                <div class="card-header">
                    <h2 class="card-title">Журнал интеграции CRM</h2>
                    <button class="btn btn-ghost btn-sm" id="clearIntegrationLogBtn">Очистить</button>
                </div>
                <div class="integration-log" id="integrationLogContainer">
                    <div class="text-center text-secondary p-5">Журнал пуст</div>
                </div>
            </div>
        </div>
    </template>

    <!-- Scripts -->
    <script src="data.js"></script>
    <script src="app.js"></script>
</body>

</html>
